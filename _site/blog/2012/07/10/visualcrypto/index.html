
<!DOCTYPE html>
<html lang="ZH-CN">
  <head>
    <meta charset="utf-8">
    <title>视觉密码(VisualCrypto)</title>
    <meta name="description" content="介绍C#的一种实现视觉密码的方式">
    <meta name="author" content="NanQi">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">

    <!-- Le HTML5 shim, for IE6-8 support of HTML elements -->
    <!--[if lt IE 9]>
      <script src="http://html5shim.googlecode.com/svn/trunk/html5.js"></script>
    <![endif]-->

    <!-- Le styles -->
    <link href="/assets/themes/twitter/bootstrap/css/bootstrap.min.css" rel="stylesheet">
    <link href="/assets/themes/twitter/bootstrap/css/bootstrap-responsive.min.css" rel="stylesheet">
    <link href="/assets/themes/twitter/css/style.css?body=1" rel="stylesheet" type="text/css" media="all">
    <link href="/assets/themes/twitter/css/prettify.css?body=1" rel="stylesheet" type="text/css" media="all">
    <link href="/assets/themes/twitter/css/docs.css?body=1" rel="stylesheet" type="text/css" media="all">
    <link href="/css/style.css?body=1" rel="stylesheet" type="text/css" media="all">
    <!-- Le fav and touch icons -->
  <!-- Update these with your own images
    <link rel="shortcut icon" href="images/favicon.ico">
    <link rel="apple-touch-icon" href="images/apple-touch-icon.png">
    <link rel="apple-touch-icon" sizes="72x72" href="images/apple-touch-icon-72x72.png">
    <link rel="apple-touch-icon" sizes="114x114" href="images/apple-touch-icon-114x114.png">
  -->
  </head>

  <body>
    <div class="navbar navbar-inverse navbar-fixed-top">
      <div class="navbar-inner">
        <div class="container">
          <button type="button" class="btn btn-navbar" data-toggle="collapse" data-target=".nav-collapse">
            <span class="icon-bar"></span>
            <span class="icon-bar"></span>
            <span class="icon-bar"></span>
          </button>
          <a class="brand" href="/">南琦的博客</a>
          <div class="nav-collapse collapse">
            <ul class="nav">
              
              
              


  
    
      
      	
      	<li>
            <a href="/archive.html">
                归档
                
            </a>
        </li>
      	
      
    
  
    
      
    
  
    
      
      	
      	<li>
            <a href="/categories.html">
                分类
                
            </a>
        </li>
      	
      
    
  
    
      
    
  
    
      
    
  
    
      
    
  
    
      
      	
      	<li>
            <a href="/questions.html">
                问题
                
            </a>
        </li>
      	
      
    
  
    
      
    
  
    
      
      	
      	<li>
            <a href="/tags.html">
                标签
                
            </a>
        </li>
      	
      
    
  



            </ul>
          </div>
        </div>
      </div>
    </div>
    <div class="container">
      <div class="content">
        
<?xml version="1.0" encoding="utf-8"?>
<div class="page-header">
  <h1>视觉密码(VisualCrypto)
    <small>
      
    </small>
  </h1>
</div>

<div class="row-fluid">
  <div class="span9">
    <div id="divPost">
      
      <p>先看效果图：</p>

<p><img src="/image/VisualCrypto/VisualCrypto_1.jpg" alt="效果图-1" /></p>

<p>将其中一个图更改透明度为50%，重叠两张图后：</p>

<p><img src="/image/VisualCrypto/VisualCrypto_2.jpg" alt="效果图-2" /></p>

<p>源于：<a href="http://leemon.com/crypto/VisualCrypto.html">http://leemon.com/crypto/VisualCrypto.html</a></p>

<p>大家可以先去看看，作者的意思是，甲乙两方需要传递消息，可以事先说好密钥，传递消息时只要给其发送stream（明文）图片即可，另一方解密，只需输入密钥和相应的消息长度（输入等量空格）即可得到ciphertext（密钥）图片，最终得到消息内容。同一张密钥图片可以匹配多张明文。</p>

<p>原理很简单，作者根据所给口令（PASSPHRASE），使用<img src="/image/VisualCrypto/VisualCrypto_3.jpg" alt="基本元素-1" />和<img src="/image/VisualCrypto/VisualCrypto_4.jpg" alt="基本元素-2" />两张图片组成了一个图片，这张图片只与口令有关。然后对于加密内容，不需要替换的地方使用相反的图片，需要替换的使用原本的图片，这样两张图片相叠就能达到需要的效果。</p>

<p>暂不讨论此等加密的好坏，仅看到作者在最后那一串font的Array就让我感叹。</p>

<p>闲来无事，也想自己写个支持中文的，于是就有了C#版的VisualCrypto</p>

<p>由于其中使用了caozhy的字模点阵提取程序：</p>

<p>参见：<a href="http://topic.csdn.net/u/20120629/17/a33f88b5-7ee8-4a0c-8915-c0c721bb30c9.html">http://topic.csdn.net/u/20120629/17/a33f88b5-7ee8-4a0c-8915-c0c721bb30c9.html</a></p>

<p><img src="/image/VisualCrypto/VisualCrypto_5.jpg" alt="效果图-3" /></p>

<p><img src="/image/VisualCrypto/VisualCrypto_6.jpg" alt="效果图-4" /></p>

<p><img src="/image/VisualCrypto/VisualCrypto_8.jpg" alt="效果图-6" /></p>

<p><img src="/image/VisualCrypto/VisualCrypto_7.jpg" alt="效果图-5" /></p>

<p>源码也已上传：<a href="http://files.cnblogs.com/nanqi/VisualCryptography.zip">http://files.cnblogs.com/nanqi/VisualCryptography.zip</a></p>

<h2>个人思路：</h2>

<p>首先将<img src="/image/VisualCrypto/VisualCrypto_3.jpg" alt="基本元素-1" />和<img src="/image/VisualCrypto/VisualCrypto_4.jpg" alt="基本元素-2" />使用私有字段<code>\_unit</code>代替</p>

<pre><code>bool[][] _unit = new bool[][] { new bool[] { true, false, false, true }, new bool[] { false, true, true, false } };
</code></pre>

<p>将用户输入的口令处理为<code>bool[256] dataCode</code>即16*16的矩阵。</p>

<p>为true则使用第一个，为false使用第二个。最后得到<code>bool[1024] _resultCode</code>即32*32的矩阵。</p>

<p>通过字模点阵获取<code>bool[256] dataMsg</code>即16*16的矩阵。</p>

<p>与口令获取的<code>bool[256] dataCode</code>进行对比生成<code>bool[256] dataDiff</code>，dataMsg中为false的对dataCode取反，为true的不变。</p>

<p>与获得resultCode方式相同，使用dataDiff获得相应的_resultMsg。</p>

<p>画出两张图。</p>

<h2>具体代码：</h2>

<pre><code>//密码
byte[] code = System.Text.Encoding.Default.GetBytes(textBox1.Text.Trim());

if (code.Length == 0)
{
   code = DEF_CODE;
}
else if (code.Length &gt; 16)
{
   code = code.Take(16).ToArray();
}
else
{
   while (code.Length &lt; 4)
   {
      code = code.Concat(code).ToArray();
   }
}

code = code.Concat(DEF_CODE.Skip(code.Length)).ToArray();

IEnumerable&lt;byte&gt; tmpDataCode = Enumerable.Empty&lt;byte&gt;();

for (int i = 0; i &lt; code.Length; i += 4)
{
   tmpDataCode = tmpDataCode.Concat(SHA512Encrypt(code.Where((by, index) =&gt; (index &amp; 3) == (i / 4 &amp; 3)).ToArray()));
}

bool[] dataCode = tmpDataCode.Select(by =&gt; Convert.ToBoolean(by &amp; 1)).ToArray();


//字模
Bitmap bmp = new Bitmap(16, 16);
Graphics g = Graphics.FromImage(bmp);
g.FillRectangle(Brushes.White, new Rectangle() { X = 0, Y = 0, Height = 16, Width = 16 });
g.DrawString(textBox2.Text, textBox2.Font, Brushes.Black, Point.Empty);

bool[] dataMsg = Enumerable.Range(0, 256).Select(a =&gt; new { x = a % 16, y = a / 16 })
.Select(x =&gt; bmp.GetPixel(x.x, x.y).GetBrightness() &gt; 0.5f ? false : true).ToArray();


//差异
bool[] dataDiff = dataCode.ToArray();

if (dataMsg.Length == dataCode.Length)
{
   for (int i = 0; i &lt; dataMsg.Length; i++)
   {
      dataDiff[i] = dataMsg[i] ? dataDiff[i] : !dataDiff[i];
   }
}

//密匙
IEnumerable&lt;bool&gt; tmpResultCode = Enumerable.Empty&lt;bool&gt;();

foreach (var item in dataCode)
{
   tmpResultCode = tmpResultCode.Concat(_unit[Convert.ToInt32(item)]);
}

_resultCode = tmpResultCode.ToArray();


//消息
IEnumerable&lt;bool&gt; tmpResultMsg = Enumerable.Empty&lt;bool&gt;();

foreach (var item in dataDiff)
{
   tmpResultMsg = tmpResultMsg.Concat(_unit[Convert.ToInt32(item)]);
}


void Draw(Graphics g, bool[] data)
{
   for (int i = 0; i &lt; 16; i++)
   for (int j = 0; j &lt; 16; j++)
   for (int k = 0; k &lt; 4; k++)
   {
      Brush brush = data[j * 4 * 16 + i * 4 + k] ? Brushes.Black : Brushes.White;

      if (k &lt; 2)
         g.FillRectangle(brush, new Rectangle() { X = i * 16 + k * 8, Y = j * 16, Width = 8, Height = 8 });
      else
         g.FillRectangle(brush, new Rectangle() { X = i * 16 + (k - 2) * 8, Y = j * 16 + 8, Width = 8, Height = 8 });
   }
}
</code></pre>

<p>源于：<a href="http://leemon.com/crypto/VisualCrypto.html">http://leemon.com/crypto/VisualCrypto.html</a></p>

<p>参见：<a href="http://topic.csdn.net/u/20120629/17/a33f88b5-7ee8-4a0c-8915-c0c721bb30c9.html">http://topic.csdn.net/u/20120629/17/a33f88b5-7ee8-4a0c-8915-c0c721bb30c9.html</a></p>

<p>源码：<a href="http://files.cnblogs.com/nanqi/VisualCryptography.zip">http://files.cnblogs.com/nanqi/VisualCryptography.zip</a></p>

    </div>
    <hr>
    <div class="pagination">
      <ul>
      
        <li class="prev disabled"><a>&larr; 上一页</a></li>
      
        <li><a href="/archive.html">列表</a></li>
      
        <li class="next"><a href="/blog/2012/07/24/lifegame" title="LifeGame">下一页 &rarr;</a></li>
      
      </ul>
    </div>
    <hr>
    


  <div id="disqus_thread"></div>
<script type="text/javascript">
    var disqus_developer = 1;
    var disqus_shortname = 'nanqi'; // required: replace example with your forum shortname
    
    /* * * DON'T EDIT BELOW THIS LINE * * */
    (function() {
        var dsq = document.createElement('script'); dsq.type = 'text/javascript'; dsq.async = true;
        dsq.src = 'http://' + disqus_shortname + '.disqus.com/embed.js';
        (document.getElementsByTagName('head')[0] || document.getElementsByTagName('body')[0]).appendChild(dsq);
    })();
</script>
<noscript>Please enable JavaScript to view the <a href="http://disqus.com/?ref_noscript">comments powered by Disqus.</a></noscript>
<a href="http://disqus.com" class="dsq-brlink">blog comments powered by <span class="logo-disqus">Disqus</span></a>




  </div>
  <div class="span3">
    <h4>Published</h4>
    <div class="date">
      <span>2012-07-10</span>
    </div>

  
    <h4>Tags</h4>
    <ul class="tag_box">
    
    


  
     
    	<li><a href="/tags.html#C#-ref">C# <span>8</span></a></li>
    
  



    </ul>
  
  </div>
</div>


      </div>

      <footer>
        <p>&copy; NanQi 2012 - 2013
          参考 <a href="http://jekyllbootstrap.com" target="_blank" title="The Definitive Jekyll Blogging Framework">Jekyll Bootstrap</a>
          和 <a href="http://twitter.github.com/bootstrap/" target="_blank">Twitter Bootstrap</a>
          源码托管在 <a href="https://github.com/nanqi">NanQi Github</a> 版权声明 <a rel="license" href="http://creativecommons.org/licenses/by-nc-sa/3.0/cn/">CC BY-NC-SA 3.0</a>
          <script src="http://s95.cnzz.com/stat.php?id=4758074&web_id=4758074" language="JavaScript"></script>
        </p>
      </footer>

    <script src="/assets/themes/twitter/js/jquery.js"></script>
    <script src="/assets/themes/twitter/js/prettify.js"></script>
    <script src="/assets/themes/twitter/js/holder.js"></script>
    <script src="/assets/themes/twitter/bootstrap/js/bootstrap.min.js"></script>
    </div> <!-- /container -->

    <script type="text/javascript">
        $(window).load(function () {
                $("pre").addClass("prettyprint linenums");
                prettyPrint();
        })
    </script>

    
  </body>
</html>

